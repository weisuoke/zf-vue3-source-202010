{"version":3,"file":"vue.js","sources":["../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArrayProtoMethods = Array.prototype;\n\n// 不能直接改写数组原有的方法 不可靠，因为只有被 vue 控制的数组才需要改写\nexport let arrayMethods = Object.create(Array.prototype)\n\nlet methods = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'splice',\n  'reverse',\n  'sort'\n]\n\nmethods.forEach(method => { // AOP 切片编程\n  arrayMethods[method] = function (...args) { // 重写数组方法\n    // todo...\n    // 有可能用户新增的数据是对象格式，也需要进行拦截\n    let result = oldArrayProtoMethods[method].call(this, ...args)\n    let inserted\n    let ob = this.__ob__\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args;\n        break;\n      case 'splice':\n        inserted = args.slice(2);\n        break;\n      default:\n        break;\n    }\n    if (inserted) ob.observeArray(inserted)\n    return result\n  }\n})\n","import {arrayMethods} from \"./array\";\n\nclass Observer {\n  constructor(value) { // 需要对这个value属性重新定义\n\n    // value 可能是对象 可能是数组，分类处理\n    Object.defineProperty(value, '__ob__', {\n      value: this,\n      enumerable: false,  // 不能被枚举表示，不能被循环\n      configurable: false,  // 不能删除此属性\n    })\n    if (Array.isArray(value)) {\n      // 数组不用 defineProperty 来进行代理，性能不好\n\n      // push shift reverse sort 我要重写这些方法增加更新逻辑\n      Object.setPrototypeOf(value, arrayMethods); // 循环将属性赋予上去\n      this.observeArray(value); // 原有数组中的对象\n    } else {\n      this.walk(value);\n    }\n  }\n  observeArray(value) {\n    for (let i = 0; i < value.length; i++) {\n      observe(value[i])\n    }\n  }\n  walk(data) {\n    // 将对象中的所有 key 重新用 defineProperty 定义成响应式的\n    Object.keys(data).forEach((key) => {\n      defineReactive(data, key, data[key])\n    })\n  }\n}\n\nexport function defineReactive(data, key, value) {  // vue2 中数据嵌套不要过深，过深浪费性能\n  // value 可能也是一个对象\n  observe(value); // 对结果递归拦截\n\n  Object.defineProperty(data, key, {\n    get() {\n      return value;\n    },\n    set(newValue) {\n      if(newValue === value) return\n      observe(newValue);  // 如果用户设置的是一个对象，就继续将用户设置的对象变成响应式的\n      value = newValue\n    }\n  })\n}\n\nexport function observe(data) {\n  // 只对对象类型进行观测 非对象类型无法观测\n  if (typeof data !== 'object' || data === null) {\n    return;\n  }\n\n  if (data.__ob__) {  // 防止循环引用了\n    return\n  }\n  // 通过类来实现对数据的观测 类可以方便扩展，会产生实例\n  return new Observer(data)\n}\n","import { observe } from \"./observer/index\";\n\n// vue的数据 data computed watch\nexport function initState(vm) {\n  // 将所有数据都定义在 vm 属性上，并且后续更改 需要触发视图更新\n  const opts = vm.$options; // 获取用户属性\n  if (opts.data) {  // 数据初始化\n    initData(vm)\n  }\n}\n\nfunction proxy(vm, source, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[source][key];\n    },\n    set(newValue) {\n      vm[source][key] = newValue\n    }\n  })\n}\n\nfunction initData(vm) {\n  // 数据劫持 Object.defineProperty\n  let data = vm.$options.data;\n  // 对 data 类型进行判断 如果是函数 获取函数返回值作为对象\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data\n  // 通过 vm._data 获取劫持后的数据，用户就拿到这个 _data\n  // 将 _data 中的数据全部放到 vm 上\n  for (let key in data) {\n    proxy(vm, '_data', key) // vm.name => vm._data.name\n  }\n\n  // 观测这个数据\n  observe(data)\n}\n\n","import { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function(options) {\n    const vm = this;\n    vm.$options = options;  // 实例上有个属性 $options 表示的是用户传入的所有属性\n    // 初始化状态\n    initState(vm);\n  }\n}\n","// Vue2.0 就是一个构造函数\nimport {initMixin} from \"./init\";\n\nfunction Vue(options) {\n  this._init(options);  // 当用户 new Vue时， 就调用 init 方法进行vue的初始化\n}\n\n// 可以拆分逻辑到不同的文件中 更利于代码维护 模块化的概念\ninitMixin(Vue)\n\nexport default Vue\n\n// 库 => rollup 项目开发 webpack\n"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","result","call","inserted","ob","__ob__","slice","observeArray","Observer","value","defineProperty","enumerable","configurable","isArray","setPrototypeOf","walk","i","length","observe","data","keys","key","defineReactive","get","set","newValue","initState","vm","opts","$options","initData","proxy","source","_data","initMixin","Vue","_init","options"],"mappings":"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"}