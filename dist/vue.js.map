{"version":3,"file":"vue.js","sources":["../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/compiler/parse.js","../src/compiler/generate.js","../src/compiler/index.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArrayProtoMethods = Array.prototype;\n\n// 不能直接改写数组原有的方法 不可靠，因为只有被 vue 控制的数组才需要改写\nexport let arrayMethods = Object.create(Array.prototype)\n\nlet methods = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'splice',\n  'reverse',\n  'sort'\n]\n\nmethods.forEach(method => { // AOP 切片编程\n  arrayMethods[method] = function (...args) { // 重写数组方法\n    // todo...\n    // 有可能用户新增的数据是对象格式，也需要进行拦截\n    let result = oldArrayProtoMethods[method].call(this, ...args)\n    let inserted\n    let ob = this.__ob__\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args;\n        break;\n      case 'splice':\n        inserted = args.slice(2);\n        break;\n      default:\n        break;\n    }\n    if (inserted) ob.observeArray(inserted)\n    return result\n  }\n})\n","import {arrayMethods} from \"./array\";\n\nclass Observer {\n  constructor(value) { // 需要对这个value属性重新定义\n\n    // value 可能是对象 可能是数组，分类处理\n    Object.defineProperty(value, '__ob__', {\n      value: this,\n      enumerable: false,  // 不能被枚举表示，不能被循环\n      configurable: false,  // 不能删除此属性\n    })\n    if (Array.isArray(value)) {\n      // 数组不用 defineProperty 来进行代理，性能不好\n\n      // push shift reverse sort 我要重写这些方法增加更新逻辑\n      Object.setPrototypeOf(value, arrayMethods); // 循环将属性赋予上去\n      this.observeArray(value); // 原有数组中的对象\n    } else {\n      this.walk(value);\n    }\n  }\n  observeArray(value) {\n    for (let i = 0; i < value.length; i++) {\n      observe(value[i])\n    }\n  }\n  walk(data) {\n    // 将对象中的所有 key 重新用 defineProperty 定义成响应式的\n    Object.keys(data).forEach((key) => {\n      defineReactive(data, key, data[key])\n    })\n  }\n}\n\nexport function defineReactive(data, key, value) {  // vue2 中数据嵌套不要过深，过深浪费性能\n  // value 可能也是一个对象\n  observe(value); // 对结果递归拦截\n\n  Object.defineProperty(data, key, {\n    get() {\n      return value;\n    },\n    set(newValue) {\n      if(newValue === value) return\n      observe(newValue);  // 如果用户设置的是一个对象，就继续将用户设置的对象变成响应式的\n      value = newValue\n    }\n  })\n}\n\nexport function observe(data) {\n  // 只对对象类型进行观测 非对象类型无法观测\n  if (typeof data !== 'object' || data === null) {\n    return;\n  }\n\n  if (data.__ob__) {  // 防止循环引用了\n    return\n  }\n  // 通过类来实现对数据的观测 类可以方便扩展，会产生实例\n  return new Observer(data)\n}\n","import { observe } from \"./observer/index\";\n\n// vue的数据 data computed watch\nexport function initState(vm) {\n  // 将所有数据都定义在 vm 属性上，并且后续更改 需要触发视图更新\n  const opts = vm.$options; // 获取用户属性\n  if (opts.data) {  // 数据初始化\n    initData(vm)\n  }\n}\n\nfunction proxy(vm, source, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[source][key];\n    },\n    set(newValue) {\n      vm[source][key] = newValue\n    }\n  })\n}\n\nfunction initData(vm) {\n  // 数据劫持 Object.defineProperty\n  let data = vm.$options.data;\n  // 对 data 类型进行判断 如果是函数 获取函数返回值作为对象\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data\n  // 通过 vm._data 获取劫持后的数据，用户就拿到这个 _data\n  // 将 _data 中的数据全部放到 vm 上\n  for (let key in data) {\n    proxy(vm, '_data', key) // vm.name => vm._data.name\n  }\n\n  // 观测这个数据\n  observe(data)\n}\n\n","const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是标签名\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 >\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\n\nexport function parseHTML(html) {\n  let root = null;\n  let currentParent\n  let stack = []\n\n  function createASTElement(tagName, attrs) { // vue3 里面支持多个根元素（外层加了一个空元素）， vue2 中只支持一个根节点\n    return {\n      tag: tagName,\n      type: 1,\n      children: [],\n      attrs,\n      parent: null\n    }\n  }\n\n  // 根据开始标签 结束标签 文本内容 生成一个 ast 语法树\n  function start(tagName, attrs) {\n    let element = createASTElement(tagName, attrs)\n    if (!root) {\n      root = element;\n    }\n    currentParent = element\n    stack.push(element)\n  }\n\n  function end(tagName) {\n    let element = stack.pop()\n    currentParent = stack[stack.length - 1]\n    if (currentParent) {\n      element.parent = currentParent;\n      currentParent.children.push(element)\n    }\n  }\n\n  function chars(text) {\n    // 解析文本\n    text = text.replace(/\\s/g, '');\n    if (text) {\n      currentParent.children.push({\n        type: 3,\n        text\n      })\n    }\n  }\n\n  function advance(n) {\n    html = html.substring(n)\n  }\n\n  function parseStartTag() {\n    const start = html.match(startTagOpen);\n    if (start) {\n      let match = {\n        tagName: start[1],\n        attrs: []\n      }\n      advance(start[0].length); // 获取元素\n      // 查找属性\n      let end,attr;\n      // 不是开头标签结尾就一直解析\n      while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\n        advance(attr[0].length);\n        match.attrs.push({name: attr[1], value: attr[3]})\n      }\n      if (end) {\n        advance(end[0].length);\n        return match\n      }\n    }\n  }\n\n  while (html) {\n    let textEnd = html.indexOf('<');\n    if (textEnd === 0) {\n      let startTagMatch = parseStartTag()\n      if (startTagMatch) { // 开始标签\n        start(startTagMatch.tagName, startTagMatch.attrs)\n        continue\n      }\n      // 结束标签\n      let endTagMatch = html.match(endTag)\n      if (endTagMatch) {\n        console.log(\"结尾：\", endTagMatch[1])\n        advance(endTagMatch[0].length)\n        end(endTagMatch[1])\n        continue;\n      }\n    }\n    let text\n    if (textEnd >= 0) { // 开始解析文本\n      text = html.substring(0, textEnd)\n    }\n    if (text) {\n      advance(text.length)\n      chars(text)\n    }\n  }\n\n  return root\n}\n","const defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\n\nfunction genProps(attrs) {\n  let str = '';\n  for(let i = 0; i < attrs.length; i++) {\n    let attr = attrs[i];  // name,value\n    if (attr.name === 'style') {\n      let obj = {}\n      attr.value.split(';').forEach(item => {\n        let [key, value] = item.split(':');\n        obj[key] = value;\n      })\n      attr.value = obj;\n    }\n    str += `${attr.name}:${JSON.stringify(attr.value)},` // {a: 'aaa'}\n  }\n  return `{${str.slice(0, -1)}}`\n}\n\nfunction genChildren(el) {\n  const children = el.children;\n  if (children) {\n    return children.map(child => gen(child)).join(',')\n  } else {\n    return false\n  }\n}\n\nfunction gen(node) {  // 区分元素还是文本\n  console.log('gen', node)\n\n  if (node.type === 1) {\n    return generate(node)\n  } else {\n    // 文本节点逻辑不能用 _c来处理\n    // 有 {{}} 普通文本 混合文本\n    let text = node.text\n    if (defaultTagRE.test(text)) {\n      // 是带有 {{}}\n      let tokens = [];\n      let match;\n      let index = 0;\n      let lastIndex = defaultTagRE.lastIndex = 0 // Todo 为什么这里等于 0\n      while(match = defaultTagRE.exec(text)) {\n        index = match.index;\n        if (index > lastIndex) {\n          tokens.push(JSON.stringify(text.slice(lastIndex, index)))\n        }\n        tokens.push(`_s(${match[1].trim()})`);\n        lastIndex = index + match[0].length;\n      }\n\n      // NOTE: 如果文本节点是这样的 {{a}} b {{c}} d, 下面的代码是为了处理 d\n      if (lastIndex < text.length) {\n        tokens.push(JSON.stringify(text.slice(lastIndex)))\n      }\n\n      return `_v(${tokens.join('+')})`\n    } else {\n      return `_v(${JSON.stringify(text)})`\n    }\n  }\n}\n\nexport function generate(el) {\n  console.log(el) // 转化成 render 代码\n\n  let children = genChildren(el)\n\n  let code = `_c('${el.tag}', ${\n    el.attrs.length ? genProps(el.attrs) : 'undefined'\n  } ${\n    children ? `,${children}` : ''\n  })`\n\n  return code;\n\n  // html代码 => js代码 字符串拼接\n}\n","import { parseHTML } from \"./parse\";\nimport { generate } from \"./generate\";\n\nexport function compileToFunctions(template) {\n  let ast = parseHTML(template)\n\n  // root\n  let code = generate(ast); // 生成代码\n\n  let render = `with(this){return ${code}}`\n  let fn = new Function(render);  // 可以让字符串变成一个函数\n\n  return fn; // render 函数已经 ok.\n}\n","import { initState } from \"./state\";\nimport { compileToFunctions } from \"./compiler/index\";\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function(options) {\n    const vm = this;\n    vm.$options = options;  // 实例上有个属性 $options 表示的是用户传入的所有属性\n    // 初始化状态\n    initState(vm);\n\n    if (vm.$options.el) { // 数据可以挂载到页面上\n      vm.$mount(vm.$options.el);\n    }\n  }\n\n  Vue.prototype.$mount = function (el) {\n    el = document.querySelector(el);\n    const vm = this;\n    const options = vm.$options\n\n    // 如果有 render 就直接使用 render\n    // 没有 render 看有没有 template 属性\n    // 没有 template 就接着找外部模板\n    if (!options.render) {\n      let template = options.template;\n      if (!template && el) {\n        template = el.outerHTML;  // 火狐不兼容 document.createElement('div').appendChild('app').innerHTML\n      }\n      console.log(template)\n      // 如何将模板编译成 render 函数\n      const render = compileToFunctions(template)\n      // options.render = render\n    }\n  }\n}\n","// Vue2.0 就是一个构造函数\nimport {initMixin} from \"./init\";\n\nfunction Vue(options) {\n  this._init(options);  // 当用户 new Vue时， 就调用 init 方法进行vue的初始化\n}\n\n// 可以拆分逻辑到不同的文件中 更利于代码维护 模块化的概念\ninitMixin(Vue)\n\nexport default Vue\n\n// 库 => rollup 项目开发 webpack\n"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","result","call","inserted","ob","__ob__","slice","observeArray","Observer","value","defineProperty","enumerable","configurable","isArray","setPrototypeOf","walk","i","length","observe","data","keys","key","defineReactive","get","set","newValue","initState","vm","opts","$options","initData","proxy","source","_data","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parseHTML","html","root","currentParent","stack","createASTElement","tagName","attrs","tag","type","children","parent","start","element","push","end","pop","chars","text","replace","advance","n","substring","parseStartTag","match","attr","name","textEnd","indexOf","startTagMatch","endTagMatch","console","log","defaultTagRE","genProps","str","obj","split","item","JSON","stringify","genChildren","el","map","child","gen","join","node","generate","test","tokens","index","lastIndex","exec","trim","code","compileToFunctions","template","ast","render","fn","Function","initMixin","Vue","_init","options","$mount","document","querySelector","outerHTML"],"mappings":"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"}